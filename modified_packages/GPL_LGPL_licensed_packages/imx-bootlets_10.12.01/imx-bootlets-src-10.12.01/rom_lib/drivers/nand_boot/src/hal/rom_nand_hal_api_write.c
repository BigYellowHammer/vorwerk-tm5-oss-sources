////////////////////////////////////////////////////////////////////////////////
//! \addtogroup rom_nand_hal
//! @{
//
// Copyright (c) 2006 SigmaTel, Inc.
//
//! \file rom_nand_hal_api_write.c
//! \brief This file provides the API for the ROM NAND HAL.
//!
//!
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////

#include <stdio.h>
#include <string.h>
#include <rom_types.h>
#include <return_codes.h>
#include "rom_nand_hal_api.h"


#ifdef WRITES_ALLOWED
////////////////////////////////////////////////////////////////////////////////
// Externs
////////////////////////////////////////////////////////////////////////////////
bool    g_bNandHalInitialized = false;

////////////////////////////////////////////////////////////////////////////////
// Definitions
//
////////////////////////////////////////////////////////////////////////////////
#define NAND_PAGES_PER_BLOCK    64
////////////////////////////////////////////////////////////////////////////////
//! Prototypes
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Variables
////////////////////////////////////////////////////////////////////////////////
//extern NAND_Descriptor_t zNANDDescriptor[MAX_NUMBER_NANDS];    // We can have up to 4 devices.

NANDInfo_t zNAND_Info = {
    256,                        // Number of Blocks in Device
    NAND_PAGES_PER_BLOCK,       // Number of Pages Per Block
    SUCCESS };

////////////////////////////////////////////////////////////////////////////////
// Code
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Write a sector using the HAL layer.
// To view function documentation, see rom_nand_hal_api.h.
////////////////////////////////////////////////////////////////////////////////
RtStatus_t rom_nand_hal_WriteSector(uint32_t u32NandDeviceNumber, uint32_t u32PageNum, 
                                  uint8_t *p8PageBuf)

{
    // Create a pointer to this device.
//    NAND_Descriptor_t * pNANDDevice = &zNANDDescriptor[uDeviceNum];
    RtStatus_t retCode;

    //rom_nand_hal_SetClearWriteProtect(NAND_DISABLE_WRITE_PROTECT);

    retCode = rom_nand_hal_WriteSectorData(u32NandDeviceNumber,
                                                  u32PageNum,
                                                  p8PageBuf);

    //rom_nand_hal_SetClearWriteProtect(NAND_ENABLE_WRITE_PROTECT);

    return retCode;
}

////////////////////////////////////////////////////////////////////////////////
// Erase a block using the HAL layer.
// To view function documentation, see rom_nand_hal_api.h.
////////////////////////////////////////////////////////////////////////////////
RtStatus_t rom_nand_hal_EraseBlock(uint32_t u32NandDeviceNumber, uint32_t u32BlockNum)
{
    // Create a pointer to this device.
//    NAND_Descriptor_t * pNANDDevice = &zNANDDescriptor[uDeviceNum];
    RtStatus_t retCode;


    //rom_nand_hal_SetClearWriteProtect(NAND_DISABLE_WRITE_PROTECT);

    retCode = rom_nand_hal_Erase_Block(u32NandDeviceNumber, u32BlockNum);

    //rom_nand_hal_SetClearWriteProtect(NAND_ENABLE_WRITE_PROTECT);

    return retCode;
}

////////////////////////////////////////////////////////////////////////////////
// Stub function to get Number of blocks, etc.
// To view function documentation, see rom_nand_hal_api.h.
////////////////////////////////////////////////////////////////////////////////
NANDInfo_t *rom_nand_hal_GetNandInfo(uint32_t u32NandDeviceNumber)
{

    return &zNAND_Info;
}

#endif  //#ifdef WRITES_ALLOWED

//! @}
